A Makefile to automatically build Xenomai packages for many
Debian/Ubuntu release and architecture combinations


Targets:

test:  list some variables and their values for debugging

<codename>/base-<arch>.tgz:  e.g. precise/base-i386.tgz
    Build the base chroot tarball with pbuilder --create

---------------------------
Random notes follow

multiple releases in a single ppa
http://bobthegnome.blogspot.com/2012/12/a-script-for-supporting-multiple-ubuntu.html

free build infra?
https://help.launchpad.net/Packaging/SourceBuilds



# my command:
sudo ARCH=amd64 http_proxy="http://proxy0.zultron.com:3128/" \
     debootstrap --arch=i386 lucid /v/tmp/debroots/lucid-32 \
     http://archive.ubuntu.com/ubuntu

sudo ARCH=amd64 http_proxy="http://proxy0.zultron.com:3128/" \
     debootstrap --arch=i386 squeeze /v/tmp/debroots/squeeze-32 \
     http://ftp.us.debian.org/debian

# chroot
sudo chroot squeeze-32
# install repo from here:
# http://wiki.linuxcnc.org/cgi-bin/wiki.pl?XenomaiKernelPackages

# fix locales in debian
apt-get install locales-all

# fix locales in ubuntu
locale-gen en_US en_US.UTF-8 && dpkg-reconfigure locales

# add 'universe' in ubuntu
echo 'deb http://us.archive.ubuntu.com/ubuntu/ lucid universe' >> \
     /etc/apt/sources.list

# install development packages
apt-get update
apt-get install -y dpkg-dev
apt-get install -y git-core module-assistant wget quilt libpci-dev

# get sources
mkdir /tmp/build && cd /tmp/build
apt-get source xenomai

# install build requirements
apt-get build-dep xenomai

# build & install xenomai
cd xenomai-2.6.2.1
dpkg-buildpackage -uc -us
cd .. && dpkg -i *.deb

# build & install kernel
apt-get source linux-source-3.5.7-xenomai-2.6.2.1
cd linux-source-3.5.7-xenomai-2.6.2.1-5
dpkg-buildpackage -uc -us -i -I
cd .. && dpkg -i linux-image-3.5.7-xenomai-2.6.2.1_5_*.deb \
   linux-headers-3.5.7-xenomai-2.6.2.1_5_*.deb

# build add-on modules
git clone git://github.com/zultron/kernel-modules-deb.git
export MODULE_LOC=`pwd`/kernel-modules-deb
cd -
dpkg-buildpackage -Tmodules && cd ..

# build smictrl
git clone git://git.kiszka.org/smictrl.git && cd smictrl
git clone git://github.com/zultron/smictrl-deb.git debian
dpkg-buildpackage -uc -us && cd ..
  
# build zultron-keyring
dpkg-source -x zultron-keyring_0.1-1.dsc
cd zultron-keyring-0.1
dpkg-buildpackage -uc -us && cd ..



sudo aptitude install debootstrap schroot

first, create a new chroot-environment (Ubuntu hardy, 64-bit):

CHROOTDIR="/var/chroot/ubuntu-hardy-x86_64"
sudo debootstrap --variant=buildd --arch amd64 hardy "${CHROOTDIR}" http://archive.ubuntu.com/ubuntu/
sudo vim "${CHROOTDIR}/etc/apt/sources.list"
sudo touch "${CHROOTDIR}/CHROOT"
echo hardy64_chroot | sudo tee ${CHROOTDIR}/etc/debian_chroot
for file in passwd shadow group gshadow hosts ; do sudo cp -av /etc/$file ${CHROOTDIR}/etc/ ; done

sudo http_proxy="http://<your.proxy.address>:<port>/" debootstrap --variant=buildd --arch amd64 hardy "${CHROOTDIR}" http://archive.ubuntu.com/ubuntu/
